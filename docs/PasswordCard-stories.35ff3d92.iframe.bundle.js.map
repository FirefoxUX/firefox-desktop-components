{"version":3,"file":"PasswordCard-stories.35ff3d92.iframe.bundle.js","mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AAKA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;ACvOA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;ACpOA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://browser-storybook/../../../toolkit/components/satchel/megalist/content/LoginLine.mjs","webpack://browser-storybook/../../../toolkit/components/satchel/megalist/content/PasswordCard.mjs","webpack://browser-storybook/../../../toolkit/components/satchel/megalist/content/PasswordCard.stories.mjs"],"sourcesContent":["import __chrome_styles_loader__LoginLineStyles from \"toolkit/components/satchel/megalist/content/LoginLine.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport {\n  html,\n  when,\n  ifDefined,\n} from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n\nclass LoginLine extends MozLitElement {\n  static properties = {\n    value: { type: String },\n    labelL10nId: { type: String },\n    lineType: { type: String },\n    inputType: { type: String },\n    favIcon: { type: String },\n    alert: { type: Boolean },\n    onLineClick: { type: Function },\n  };\n\n  #copyTimeoutID;\n\n  static get queries() {\n    return {\n      lineContainer: \".line-container\",\n    };\n  }\n\n  #canCopy() {\n    return this.lineType !== \"origin\";\n  }\n\n  #addCopyAttr() {\n    return ifDefined(this.#canCopy() ? \"data-after\" : undefined);\n  }\n\n  #handleCopyAnimation() {\n    if (!this.lineContainer.classList.contains(\"copied\")) {\n      this.lineContainer.classList.add(\"copied\");\n      this.#copyTimeoutID = setTimeout(() => {\n        this.lineContainer.classList.remove(\"copied\");\n        this.#copyTimeoutID = null;\n      }, 4000);\n    }\n  }\n\n  async #onClick() {\n    const isAuthorized = await this.onLineClick();\n    if (!isAuthorized || !this.#canCopy()) {\n      return;\n    }\n    this.#handleCopyAnimation();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener(\"click\", this.#onClick);\n    this.addEventListener(\"keypress\", async e => {\n      if (e.code === \"Enter\" || e.code === \"Space\") {\n        e.preventDefault();\n        await this.#onClick();\n      }\n    });\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this.#copyTimeoutID) {\n      clearTimeout(this.#copyTimeoutID);\n    }\n  }\n\n  constructor() {\n    super();\n    this.favIcon = \"\";\n    this.#copyTimeoutID = null;\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__LoginLineStyles}\"\n      />\n      <div class=\"line-container\">\n        <div class=\"input-container\">\n          <div class=\"label-container\">\n            <label\n              data-l10n-id=${this.labelL10nId}\n              data-l10n-attrs=${this.#addCopyAttr()}\n              class=\"input-label\"\n              for=\"login-line-input\"\n            ></label>\n            ${when(\n              this.alert,\n              () =>\n                html` <img\n                  data-l10n-id=\"alert-icon\"\n                  class=\"alert-icon\"\n                  src=\"chrome://global/skin/icons/warning-fill-12.svg\"\n                />`\n            )}\n          </div>\n          <div class=\"value-container\">\n            ${when(\n              this.favIcon,\n              () =>\n                html` <img\n                  data-l10n-id=\"website-icon\"\n                  class=\"fav-icon\"\n                  src=${this.favIcon}\n                />`\n            )}\n            <input\n              class=\"input-field\"\n              id=\"login-line-input\"\n              value=${this.value}\n              type=${this.inputType}\n              readonly\n            />\n          </div>\n        </div>\n        ${when(this.#canCopy(), () => {\n          return html`\n            <div class=\"copy-container\">\n              <img\n                data-l10n-id=\"copy-icon\"\n                class=\"copy-icon\"\n                src=\"chrome://global/skin/icons/edit-copy.svg\"\n              />\n              <img\n                data-l10n-id=\"check-icon\"\n                class=\"check-icon\"\n                src=\"chrome://global/skin/icons/check-filled.svg\"\n              />\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n\nclass ConcealedLoginLine extends MozLitElement {\n  static properties = {\n    value: { type: String },\n    labelL10nId: { type: String },\n    alert: { type: Boolean },\n    visible: { type: Boolean },\n    onLineClick: { type: Function },\n    onButtonClick: { type: Function },\n  };\n\n  static CONCEALED_VALUE_TEXT = \" \".repeat(8);\n\n  static get queries() {\n    return {\n      loginLine: \"login-line\",\n      revealBtn: \"moz-button\",\n    };\n  }\n\n  get #inputType() {\n    return !this.visible ? \"password\" : \"text\";\n  }\n\n  get #displayValue() {\n    return !this.visible ? ConcealedLoginLine.CONCEALED_VALUE_TEXT : this.value;\n  }\n\n  get #revealBtnLabel() {\n    return !this.visible ? \"show-password-button\" : \"hide-password-button\";\n  }\n\n  #revealIconSrc() {\n    return this.visible\n      ? /* eslint-disable-next-line mozilla/no-browser-refs-in-toolkit */\n        \"chrome://browser/content/aboutlogins/icons/password-hide.svg\"\n      : /* eslint-disable-next-line mozilla/no-browser-refs-in-toolkit */\n        \"chrome://browser/content/aboutlogins/icons/password.svg\";\n  }\n\n  async #onRevealButtonClick() {\n    const isAuthorized = await this.onButtonClick();\n    if (!isAuthorized) {\n      return;\n    }\n    this.revealBtn.setAttribute(\"data-l10n-id\", this.#revealBtnLabel);\n  }\n\n  render() {\n    return html` <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__LoginLineStyles}\"\n      />\n      <login-line\n        role=\"option\"\n        tabindex=\"-1\"\n        data-l10n-id=\"password-login-line\"\n        lineType=\"password\"\n        inputType=${this.#inputType}\n        labelL10nId=${this.labelL10nId}\n        .value=${this.#displayValue}\n        ?alert=${this.alert}\n        .onLineClick=${this.onLineClick}\n        }\n      >\n      </login-line>\n      <div class=\"reveal-button-container\">\n        <moz-button\n          role=\"option\"\n          class=\"reveal-button\"\n          type=\"icon ghost\"\n          data-l10n-id=${this.#revealBtnLabel}\n          iconSrc=${this.#revealIconSrc()}\n          @keypress=${async e => {\n            if (e.code === \"Enter\") {\n              await this.#onRevealButtonClick();\n            }\n          }}\n          @click=${this.#onRevealButtonClick}\n        ></moz-button>\n      </div>`;\n  }\n}\n\ncustomElements.define(\"login-line\", LoginLine);\ncustomElements.define(\"concealed-login-line\", ConcealedLoginLine);\n","import __chrome_styles_loader__PasswordCardStyles from \"toolkit/components/satchel/megalist/content/PasswordCard.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n\n/* eslint-disable-next-line import/no-unassigned-import */\nimport \"chrome://global/content/megalist/LoginLine.mjs\";\n\nconst DIRECTIONS = {\n  ArrowUp: -1,\n  ArrowLeft: -1,\n  ArrowDown: 1,\n  ArrowRight: 1,\n};\n\nexport class PasswordCard extends MozLitElement {\n  static properties = {\n    origin: { type: Object },\n    username: { type: Object },\n    password: { type: Object },\n    messageToViewModel: { type: Function },\n    reauthCommandHandler: { type: Function },\n    onPasswordRevealClick: { type: Function },\n    handleEditButtonClick: { type: Function },\n  };\n\n  static get queries() {\n    return {\n      originLine: \".line-item[linetype='origin']\",\n      usernameLine: \".line-item[linetype='username']\",\n      passwordLine: \"concealed-login-line\",\n      editBtn: \".edit-button\",\n    };\n  }\n\n  #focusableElementsList;\n  #focusableElementsMap;\n\n  /**\n   * Returns the first focusable element of the next password card componenet.\n   * If the user is navigating down, then the next focusable element should be the edit button,\n   * and if the user is navigating up, then it should be the origin line.\n   *\n   * @param {string} keyCode - The code associated with a keypress event. Either 'ArrowUp' or 'ArrowDown'.\n   * @returns {HTMLElement | null} The first focusable element of the next password-card.\n   */\n  #getNextFocusableElement(keyCode) {\n    return keyCode === \"ArrowDown\"\n      ? this.nextElementSibling?.originLine\n      : this.previousElementSibling?.editBtn;\n  }\n\n  async firstUpdated() {\n    this.#focusableElementsMap = new Map();\n\n    let index = 0;\n    for (const el of this.shadowRoot.querySelectorAll(\".line-item\")) {\n      if (el === this.passwordLine) {\n        await el.updateComplete;\n        this.#focusableElementsMap.set(el.loginLine, index++);\n        this.#focusableElementsMap.set(el.revealBtn.buttonEl, index++);\n      } else {\n        this.#focusableElementsMap.set(el, index++);\n      }\n    }\n\n    this.#focusableElementsMap.set(this.editBtn.buttonEl, index);\n    this.#focusableElementsList = Array.from(this.#focusableElementsMap.keys());\n  }\n\n  #handleKeydown(e) {\n    const element = e.composedTarget;\n\n    const focusInternal = offset => {\n      const index = this.#focusableElementsMap.get(element);\n      this.#focusableElementsList[index + offset].focus();\n    };\n\n    switch (e.code) {\n      case \"ArrowUp\":\n        e.preventDefault();\n        if (this.#focusableElementsMap.get(element) === 0) {\n          this.#getNextFocusableElement(e.code)?.focus();\n        } else {\n          focusInternal(DIRECTIONS[e.code]);\n        }\n        break;\n      case \"ArrowDown\":\n        e.preventDefault();\n        if (\n          this.#focusableElementsMap.get(element) ===\n          this.#focusableElementsList.length - 1\n        ) {\n          this.#getNextFocusableElement(e.code)?.focus();\n        } else {\n          focusInternal(DIRECTIONS[e.code]);\n        }\n        break;\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener(\"keydown\", e => this.#handleKeydown(e), {\n      capture: true,\n    });\n  }\n\n  handleCommand(commandId, lineIndex) {\n    this.messageToViewModel(\"Command\", { commandId, snapshotId: lineIndex });\n  }\n\n  async onEditButtonClick() {\n    const isAuthenticated = await this.reauthCommandHandler(() =>\n      this.messageToViewModel(\"Command\", {\n        commandId: \"Edit\",\n        snapshotId: this.password.lineIndex,\n      })\n    );\n\n    if (!isAuthenticated) {\n      return;\n    }\n\n    this.handleEditButtonClick();\n  }\n\n  #onOriginLineClick(lineIndex) {\n    this.handleCommand(\"OpenLink\", lineIndex);\n  }\n\n  #onCopyButtonClick(lineIndex) {\n    this.handleCommand(\"Copy\", lineIndex);\n  }\n\n  renderOriginField() {\n    return html`\n      <login-line\n        tabindex=\"-1\"\n        role=\"option\"\n        class=\"line-item\"\n        data-l10n-id=\"origin-login-line\"\n        data-l10n-args=\"${JSON.stringify({ url: this.origin.value })}\"\n        inputType=\"text\"\n        lineType=\"origin\"\n        labelL10nId=\"passwords-origin-label\"\n        .value=${this.origin.value}\n        .favIcon=${this.origin.valueIcon}\n        ?alert=${this.origin.breached}\n        .onLineClick=${() => {\n          this.#onOriginLineClick(this.origin.lineIndex);\n          return true;\n        }}\n      >\n      </login-line>\n    `;\n  }\n\n  renderUsernameField() {\n    return html`\n      <login-line\n        tabindex=\"-1\"\n        role=\"option\"\n        class=\"line-item\"\n        data-l10n-id=\"username-login-line\"\n        data-l10n-args=\"${JSON.stringify({ username: this.username.value })}\"\n        inputType=\"text\"\n        lineType=\"username\"\n        labelL10nId=\"passwords-username-label\"\n        .value=${this.username.value}\n        .onLineClick=${() => {\n          this.#onCopyButtonClick(this.username.lineIndex);\n          return true;\n        }}\n        ?alert=${this.username.value.length === 0}\n      >\n      </login-line>\n    `;\n  }\n\n  renderPasswordField() {\n    return html`\n      <concealed-login-line\n        class=\"line-item\"\n        labelL10nId=\"passwords-password-label\"\n        .value=${this.password.value}\n        .visible=${!this.password.concealed}\n        ?alert=${this.password.vulnerable}\n        .onLineClick=${() =>\n          this.reauthCommandHandler(() =>\n            this.#onCopyButtonClick(this.password.lineIndex)\n          )}\n        .onButtonClick=${() =>\n          this.reauthCommandHandler(() =>\n            this.onPasswordRevealClick(\n              this.password.concealed,\n              this.password.lineIndex\n            )\n          )}\n      >\n      </concealed-login-line>\n    `;\n  }\n\n  renderButton() {\n    return html`<div class=\"edit-line-container\" role=\"option\">\n      <moz-button\n        data-l10n-id=\"edit-login-button\"\n        class=\"edit-button\"\n        @click=${this.onEditButtonClick}\n      ></moz-button>\n    </div>`;\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__PasswordCardStyles}\"\n      />\n      ${this.renderOriginField()} ${this.renderUsernameField()}\n      ${this.renderPasswordField()} ${this.renderButton()}\n    `;\n  }\n}\n\ncustomElements.define(\"password-card\", PasswordCard);\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n// eslint-disable-next-line import/no-unresolved\nimport { html } from \"lit.all.mjs\";\nimport \"./PasswordCard.mjs\";\n\nexport default {\n  title: \"Domain-specific UI Widgets/Credential Management/Password Card\",\n  component: \"PasswordCard\",\n  argTypes: {\n    website: { control: { type: \"object\" } },\n    username: { control: { type: \"object\" } },\n    password: { control: { type: \"object\" } },\n  },\n};\n\nwindow.MozXULElement.insertFTLIfNeeded(\"preview/megalist.ftl\");\n\nconst Template = ({ website, username, password }) => {\n  return html`\n    <password-card\n      role=\"group\"\n      .origin=${website}\n      .username=${username}\n      .password=${password}\n      .messageToViewModel=${() => {}}\n      .reauthCommandHandler=${() => true}\n    >\n    </password-card>\n  `;\n};\n\nexport const Default = Template.bind({});\nDefault.args = {\n  website: {\n    value: \"website.com\",\n    breached: false,\n    valueIcon: \"chrome://global/skin/icons/defaultFavicon.svg\",\n  },\n  username: {\n    value: \"username\",\n  },\n  password: {\n    value: \"password\",\n    vulnerable: false,\n    concealed: true,\n  },\n};\n\nexport const AllAlertsOn = Template.bind({});\nAllAlertsOn.args = {\n  website: {\n    value: \"website.com\",\n    breached: true,\n    valueIcon: \"chrome://global/skin/icons/defaultFavicon.svg\",\n  },\n  username: {\n    value: \"\",\n  },\n  password: {\n    value: \"password\",\n    vulnerable: true,\n    concealed: true,\n  },\n};\n"],"names":[],"sourceRoot":""}