{"version":3,"file":"3754.1c120347.iframe.bundle.js","mappings":";;;;;;;;AAAA;AACA;AACA;;AAEA;;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;;;;;;;;;;;AC9CA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;;AAEA;AACA;AACA;AAIA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAIA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAQA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AAIA;AAKA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA","sources":["webpack:///../../../toolkit/content/widgets/colorpicker.mjs","webpack:///../../../toolkit/content/widgets/colorpicker-common.mjs"],"sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n// @ts-nocheck Do this after migration from devtools\n\nimport { ColorPickerCommon } from \"./colorpicker-common.mjs\";\n\nclass ColorPicker extends ColorPickerCommon {\n  onChange() {\n    window.postMessage(\n      {\n        name: \"PickerPopupChanged\",\n        detail: { rgb: this.rgbFloat },\n      },\n      \"*\"\n    );\n  }\n}\n\nlet picker = new ColorPicker(document.body);\nwindow.addEventListener(\"message\", ev => {\n  switch (ev.data.name) {\n    case \"PickerInit\": {\n      let { value } = ev.data.detail;\n      picker.rgbFloat = [\n        value.component1,\n        value.component2,\n        value.component3,\n        1,\n      ];\n      picker.show();\n    }\n  }\n});\n\nwindow.addEventListener(\"keydown\", ev => {\n  if ([\"Enter\", \"Escape\", \" \"].includes(ev.key)) {\n    window.postMessage(\n      {\n        name: \"ClosePopup\",\n        detail: ev.key === \"Escape\",\n      },\n      \"*\"\n    );\n  }\n});\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n// @ts-nocheck Do this after migration from devtools\n\nconst lazy = {};\nChromeUtils.defineLazyGetter(lazy, \"l10n\", function () {\n  return new Localization([\"devtools/client/inspector.ftl\"], true);\n});\n\nconst ARROW_KEYS = [\"ArrowUp\", \"ArrowRight\", \"ArrowDown\", \"ArrowLeft\"];\nconst [ArrowUp, ArrowRight, ArrowDown, ArrowLeft] = ARROW_KEYS;\nconst SLIDER = {\n  hue: {\n    MIN: \"0\",\n    MAX: \"128\",\n    STEP: \"1\",\n  },\n  alpha: {\n    MIN: \"0\",\n    MAX: \"1\",\n    STEP: \"0.01\",\n  },\n};\n\n/**\n * ColorPickerCommon creates a color picker widget in a container you give it.\n */\nexport class ColorPickerCommon {\n  constructor(element) {\n    this.document = element.ownerDocument;\n    this.element = element;\n\n    this.element.className = \"spectrum-container\";\n\n    this.onElementClick = this.onElementClick.bind(this);\n    this.element.addEventListener(\"click\", this.onElementClick);\n\n    // Color spectrum dragger.\n    this.dragger = this.element.querySelector(\".spectrum-color\");\n    this.dragger.title = lazy.l10n.formatValueSync(\n      \"colorpicker-tooltip-spectrum-dragger-title\"\n    );\n\n    this.dragHelper = this.element.querySelector(\".spectrum-dragger\");\n    draggable(this.dragger, this.dragHelper, this.onDraggerMove.bind(this));\n\n    // Here we define the components for the \"controls\" section of the color picker.\n    this.controls = this.element.querySelector(\".spectrum-controls\");\n    this.colorPreview = this.element.querySelector(\".spectrum-color-preview\");\n\n    // Hue slider and alpha slider\n    this.hueSlider = this.createSlider(\"hue\", this.onHueSliderMove.bind(this));\n    this.hueSlider.setAttribute(\"aria-describedby\", this.dragHelper.id);\n    this.alphaSlider = this.createSlider(\n      \"alpha\",\n      this.onAlphaSliderMove.bind(this)\n    );\n  }\n\n  /** @param {[number, number, number, number]} color */\n  set rgb([r, g, b, a]) {\n    this.rgbFloat = [r / 255, g / 255, b / 255, a];\n  }\n\n  /** @param {[number, number, number, number]} color */\n  set rgbFloat([r, g, b, a]) {\n    this.hsv = [...InspectorUtils.rgbToHsv(r, g, b), a];\n  }\n\n  #toRgbInt(rgbFloat) {\n    return rgbFloat.map(c => Math.round(c * 255));\n  }\n\n  get rgbFloat() {\n    const [h, s, v, a] = this.hsv;\n    return [...InspectorUtils.hsvToRgb(h, s, v), a];\n  }\n\n  get rgb() {\n    const [r, g, b, a] = this.rgbFloat;\n    return [...this.#toRgbInt([r, g, b]), a];\n  }\n\n  /**\n   * Map current rgb to the closest color available in the database by\n   * calculating the delta-E between each available color and the current rgb\n   *\n   * @return {string}\n   *         Color name or closest color name\n   */\n  get colorName() {\n    const [r, g, b] = this.rgbFloat;\n    const { exact, colorName } = InspectorUtils.rgbToNearestColorName(r, g, b);\n    return exact\n      ? colorName\n      : lazy.l10n.formatValueSync(\"colorpicker-tooltip-color-name-title\", {\n          colorName,\n        });\n  }\n\n  get rgbNoSatVal() {\n    return [\n      ...this.#toRgbInt(InspectorUtils.hsvToRgb(this.hsv[0], 1, 1)),\n      this.hsv[3],\n    ];\n  }\n\n  get rgbCssString() {\n    const rgb = this.rgb;\n    return (\n      \"rgba(\" + rgb[0] + \", \" + rgb[1] + \", \" + rgb[2] + \", \" + rgb[3] + \")\"\n    );\n  }\n\n  show() {\n    this.dragWidth = this.dragger.offsetWidth;\n    this.dragHeight = this.dragger.offsetHeight;\n    this.dragHelperHeight = this.dragHelper.offsetHeight;\n    this.dragger.focus({ focusVisible: false });\n\n    this.updateUI();\n  }\n\n  onElementClick(e) {\n    e.stopPropagation();\n  }\n\n  onHueSliderMove() {\n    this.hsv[0] = this.hueSlider.value / this.hueSlider.max;\n    this.updateUI();\n    this.onChange();\n  }\n\n  onDraggerMove(dragX, dragY) {\n    this.hsv[1] = dragX / this.dragWidth;\n    this.hsv[2] = (this.dragHeight - dragY) / this.dragHeight;\n    this.updateUI();\n    this.onChange();\n  }\n\n  onAlphaSliderMove() {\n    this.hsv[3] = this.alphaSlider.value / this.alphaSlider.max;\n    this.updateUI();\n    this.onChange();\n  }\n\n  onChange() {\n    throw new Error(\"Not implemented\");\n  }\n\n  /**\n   * Creates and initializes a slider element, attaches it to its parent container\n   * based on the slider type and returns it\n   *\n   * @param  {\"alpha\" | \"hue\"} sliderType\n   *         The type of the slider (i.e. alpha or hue)\n   * @param  {Function} onSliderMove\n   *         The function to tie the slider to on input\n   * @return {HTMLInputElement}\n   *         Newly created slider\n   */\n  createSlider(sliderType, onSliderMove) {\n    const container = this.element.querySelector(`.spectrum-${sliderType}`);\n\n    const slider = this.document.createElement(\"input\");\n    slider.className = `spectrum-${sliderType}-input`;\n    slider.type = \"range\";\n    slider.min = SLIDER[sliderType].MIN;\n    slider.max = SLIDER[sliderType].MAX;\n    slider.step = SLIDER[sliderType].STEP;\n    slider.title = lazy.l10n.formatValueSync(\n      `colorpicker-tooltip-${sliderType}-slider-title`\n    );\n    slider.addEventListener(\"input\", onSliderMove);\n\n    container.appendChild(slider);\n    return slider;\n  }\n\n  updateAlphaSlider() {\n    // Set alpha slider background\n    const rgb = this.rgb;\n\n    const rgbNoAlpha = \"rgb(\" + rgb[0] + \",\" + rgb[1] + \",\" + rgb[2] + \")\";\n    const rgbAlpha0 = \"rgba(\" + rgb[0] + \",\" + rgb[1] + \",\" + rgb[2] + \", 0)\";\n    const alphaGradient =\n      \"linear-gradient(to right, \" + rgbAlpha0 + \", \" + rgbNoAlpha + \")\";\n    this.alphaSlider.style.background = alphaGradient;\n  }\n\n  updateColorPreview() {\n    // Overlay the rgba color over a checkered image background.\n    this.colorPreview.style.setProperty(\"--overlay-color\", this.rgbCssString);\n\n    // We should be able to distinguish the color preview on high luminance rgba values.\n    // Give the color preview a light grey border if the luminance of the current rgba\n    // tuple is great.\n    const colorLuminance = InspectorUtils.relativeLuminance(...this.rgbFloat);\n    this.colorPreview.classList.toggle(\"high-luminance\", colorLuminance > 0.85);\n\n    // Set title on color preview for better UX\n    this.colorPreview.title = this.colorName;\n  }\n\n  updateDragger() {\n    // Set dragger background color\n    const flatColor =\n      \"rgb(\" +\n      this.rgbNoSatVal[0] +\n      \", \" +\n      this.rgbNoSatVal[1] +\n      \", \" +\n      this.rgbNoSatVal[2] +\n      \")\";\n    this.dragger.style.backgroundColor = flatColor;\n\n    // Set dragger aria attributes\n    this.dragger.setAttribute(\"aria-valuetext\", this.rgbCssString);\n  }\n\n  updateHueSlider() {\n    // Set hue slider aria attributes\n    this.hueSlider.setAttribute(\"aria-valuetext\", this.rgbCssString);\n  }\n\n  updateHelperLocations() {\n    const h = this.hsv[0];\n    const s = this.hsv[1];\n    const v = this.hsv[2];\n\n    // Placing the color dragger\n    let dragX = s * this.dragWidth;\n    let dragY = this.dragHeight - v * this.dragHeight;\n    const helperDim = this.dragHelperHeight / 2;\n\n    dragX = Math.max(\n      -helperDim,\n      Math.min(this.dragWidth - helperDim, dragX - helperDim)\n    );\n    dragY = Math.max(\n      -helperDim,\n      Math.min(this.dragHeight - helperDim, dragY - helperDim)\n    );\n\n    this.dragHelper.style.top = dragY + \"px\";\n    this.dragHelper.style.left = dragX + \"px\";\n\n    // Placing the hue slider\n    this.hueSlider.value = h * this.hueSlider.max;\n\n    // Placing the alpha slider\n    this.alphaSlider.value = this.hsv[3] * this.alphaSlider.max;\n  }\n\n  updateUI() {\n    this.updateHelperLocations();\n\n    this.updateColorPreview();\n    this.updateDragger();\n    this.updateHueSlider();\n    this.updateAlphaSlider();\n  }\n\n  destroy() {\n    this.element.removeEventListener(\"click\", this.onElementClick);\n    this.hueSlider.removeEventListener(\"input\", this.onHueSliderMove);\n    this.alphaSlider.removeEventListener(\"input\", this.onAlphaSliderMove);\n\n    this.element.remove();\n\n    this.dragger = this.dragHelper = null;\n    this.alphaSlider = null;\n    this.hueSlider = null;\n    this.colorPreview = null;\n    this.element = null;\n  }\n}\n\nfunction draggable(element, dragHelper, onmove) {\n  const doc = element.ownerDocument;\n  let dragging = false;\n  let offset = {};\n  let maxHeight = 0;\n  let maxWidth = 0;\n\n  function setDraggerDimensionsAndOffset() {\n    maxHeight = element.offsetHeight;\n    maxWidth = element.offsetWidth;\n    offset = element.getBoundingClientRect();\n  }\n\n  function prevent(e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function move(e) {\n    if (dragging) {\n      if (e.buttons === 0) {\n        // The button is no longer pressed but we did not get a pointerup event.\n        stop();\n        return;\n      }\n      const pageX = e.pageX;\n      const pageY = e.pageY;\n\n      const dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));\n      const dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));\n\n      onmove.apply(element, [dragX, dragY]);\n    }\n  }\n\n  function start(e) {\n    const rightClick = e.which === 3;\n\n    if (!rightClick && !dragging) {\n      dragging = true;\n      setDraggerDimensionsAndOffset();\n\n      move(e);\n\n      doc.addEventListener(\"selectstart\", prevent);\n      doc.addEventListener(\"dragstart\", prevent);\n      doc.addEventListener(\"mousemove\", move);\n      doc.addEventListener(\"mouseup\", stop);\n\n      prevent(e);\n    }\n  }\n\n  function stop() {\n    if (dragging) {\n      doc.removeEventListener(\"selectstart\", prevent);\n      doc.removeEventListener(\"dragstart\", prevent);\n      doc.removeEventListener(\"mousemove\", move);\n      doc.removeEventListener(\"mouseup\", stop);\n    }\n    dragging = false;\n  }\n\n  function onKeydown(e) {\n    const { key } = e;\n\n    if (!ARROW_KEYS.includes(key)) {\n      return;\n    }\n\n    setDraggerDimensionsAndOffset();\n    const { offsetHeight, offsetTop, offsetLeft } = dragHelper;\n    let dragX = offsetLeft + offsetHeight / 2;\n    let dragY = offsetTop + offsetHeight / 2;\n\n    if (key === ArrowLeft && dragX > 0) {\n      dragX -= 1;\n    } else if (key === ArrowRight && dragX < maxWidth) {\n      dragX += 1;\n    } else if (key === ArrowUp && dragY > 0) {\n      dragY -= 1;\n    } else if (key === ArrowDown && dragY < maxHeight) {\n      dragY += 1;\n    }\n\n    onmove.apply(element, [dragX, dragY]);\n  }\n\n  element.addEventListener(\"mousedown\", start);\n  element.addEventListener(\"keydown\", onKeydown);\n}\n"],"names":[],"sourceRoot":""}