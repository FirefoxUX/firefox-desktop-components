{"version":3,"file":"components-ai-chat-content-ai-chat-content-stories.26bcec49.iframe.bundle.js","mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACrOA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/HA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;AC1JA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AAKA;AAKA;AAKA;AAKA;AAIA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxYA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAIA;AAEA","sources":["webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-footer/applied-memories-button.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-error/chat-assistant-error.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-footer/assistant-message-footer.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-loader/chat-assistant-loader.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/ai-chat-content.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/ai-chat-content.stories.mjs"],"sourcesContent":["import __chrome_styles_loader__appliedmemoriesbuttonStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-footer/applied-memories-button.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\n\n/**\n * AppliedMemoriesButton\n *\n * TODO: Currently using placeholder \"Highlights\" icon which will be replaced\n * with the memories icon once ready\n *\n * Custom element that renders the “Memories applied” pill and popover for\n * a single assistant message. The popover shows a list of applied\n * memories and allows the user to:\n *   - Remove an individual applied memory.\n *   - Retry the message without any applied memories.\n *\n * @property {string|null} messageId\n *   Identifier for the assistant message this control belongs to.\n *\n * @property {Array<object>} appliedMemories\n *   List of applied memories for the message. The component will render up\n *   to the first 5 items in the popover.\n *\n * @property {boolean} open\n *   Whether the popover is currently open. This is typically controlled\n *   internally when the button is clicked and also reflected via the\n *   \"toggle-applied-memories\" event.\n *\n * Events dispatched:\n *   - \"toggle-applied-memories\"\n *       detail: { messageId, open }\n *   - \"remove-applied-memory\"\n *       detail: { memoryId }\n *   - \"retry-without-memories\"\n *       detail: { messageId }\n */\nexport class AppliedMemoriesButton extends MozLitElement {\n  static properties = {\n    messageId: { type: String, attribute: \"message-id\" },\n    appliedMemories: { attribute: false },\n    open: { type: Boolean, reflect: false },\n  };\n\n  constructor() {\n    super();\n    this.messageId = null;\n    this.appliedMemories = [];\n    this.open = false;\n\n    this._onDocumentClick = this._onDocumentClick.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    document.addEventListener(\"click\", this._onDocumentClick);\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener(\"click\", this._onDocumentClick);\n    super.disconnectedCallback();\n  }\n\n  get _hasMemories() {\n    return Array.isArray(this.appliedMemories) && !!this.appliedMemories.length;\n  }\n\n  get _visibleMemories() {\n    return this.appliedMemories.slice(0, 5);\n  }\n\n  #onTriggerClick(event) {\n    event.stopPropagation();\n    if (!this._hasMemories) {\n      return;\n    }\n\n    this.open = !this.open;\n    this.toggleAttribute(\"data-open\", this.open);\n\n    this.dispatchEvent(\n      new CustomEvent(\"toggle-applied-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n          open: this.open,\n        },\n      })\n    );\n  }\n\n  _onPopoverClick(event) {\n    event.stopPropagation();\n  }\n\n  _onDocumentClick() {\n    if (!this.open) {\n      return;\n    }\n    this.open = false;\n    this.toggleAttribute(\"data-open\", false);\n    this.requestUpdate();\n\n    this.dispatchEvent(\n      new CustomEvent(\"toggle-applied-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n          open: false,\n        },\n      })\n    );\n  }\n\n  _onRemoveMemory(event, memory) {\n    event.stopPropagation();\n\n    this.dispatchEvent(\n      new CustomEvent(\"remove-applied-memory\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          memory,\n          messageId: this.messageId,\n        },\n      })\n    );\n  }\n\n  _onRetryWithoutMemories(event) {\n    event.stopPropagation();\n\n    this.dispatchEvent(\n      new CustomEvent(\"retry-without-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n        },\n      })\n    );\n  }\n\n  renderPopover() {\n    if (!this._hasMemories) {\n      return nothing;\n    }\n\n    const isOpen = this.open;\n    const visibleMemories = this._visibleMemories;\n\n    return html`\n      <div\n        class=\"popover ${isOpen ? \"open\" : \"\"}\"\n        role=\"region\"\n        aria-hidden=${!isOpen}\n        @click=${event => this._onPopoverClick(event)}\n      >\n        <ul class=\"memories-list\">\n          ${visibleMemories.map(memory => {\n            // @todo Bug 2010069\n            // Localize aria-label\n            return html`\n              <li class=\"memories-list-item\">\n                <span class=\"memories-list-label\"\n                  >${memory.memory_summary}</span\n                >\n                <moz-button\n                  class=\"memories-remove-button\"\n                  type=\"ghost\"\n                  size=\"small\"\n                  iconsrc=\"chrome://global/skin/icons/close.svg\"\n                  aria-label=\"Remove this memory\"\n                  @click=${event => this._onRemoveMemory(event, memory)}\n                ></moz-button>\n              </li>\n            `;\n          })}\n        </ul>\n\n        <div class=\"retry-row\">\n          <moz-button\n            type=\"ghost\"\n            size=\"default\"\n            iconsrc=\"chrome://global/skin/icons/reload.svg\"\n            iconposition=\"start\"\n            class=\"retry-row-button\"\n            data-l10n-id=\"aiwindow-retry-without-memories\"\n            data-l10n-attrs=\"label\"\n            @click=${event => this._onRetryWithoutMemories(event)}\n          ></moz-button>\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    if (!this._hasMemories) {\n      return null;\n    }\n\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__appliedmemoriesbuttonStyles}\"\n      />\n      <moz-button\n        class=\"memories-trigger\"\n        type=\"ghost\"\n        size=\"small\"\n        iconposition=\"start\"\n        iconsrc=\"chrome://browser/content/aiwindow/assets/memories-on.svg\"\n        aria-haspopup=\"dialog\"\n        aria-expanded=${this.open && this._hasMemories}\n        data-l10n-id=\"aiwindow-memories-used\"\n        data-l10n-attrs=\"label\"\n        @click=${event => this.#onTriggerClick(event)}\n      ></moz-button>\n\n      ${this.renderPopover()}\n    `;\n  }\n}\n\ncustomElements.define(\"applied-memories-button\", AppliedMemoriesButton);\n","import __chrome_styles_loader__chatassistanterrorStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-error/chat-assistant-error.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\n\nconst ERROR_TYPES = {\n  PAYLOAD_TOO_LARGE: 413,\n  RATE_LIMIT: 429,\n  SERVER_ERROR_MIN: 500,\n  SERVER_ERROR_MAX: 599,\n};\n\n/**\n * Shows an error message based on an error status\n */\nexport class ChatAssistantError extends MozLitElement {\n  static properties = {\n    errorStatus: { type: Number },\n    actionButton: { type: Object },\n    errorText: { type: Object },\n  };\n\n  constructor() {\n    super();\n    this.actionButton = null;\n    this.errorText = {\n      header: \"smartwindow-assistant-error-generic-header\",\n    };\n  }\n\n  willUpdate(changed) {\n    if (changed.has(\"errorStatus\")) {\n      this.getErrorInformation();\n    }\n  }\n\n  // TO DO: implement action buttons functionality\n\n  /* https://mozilla-hub.atlassian.net/browse/GENAI-2863\n  also needs its own error message/functionality */\n\n  retryAssistantMessage() {\n    const event = new CustomEvent(\"aiChatError:retry-message\", {\n      bubbles: true,\n      composed: true,\n    });\n    this.dispatchEvent(event);\n  }\n\n  /* https://mozilla-hub.atlassian.net/browse/GENAI-3170\n  switchToClassic() {\n    console.log(\"switch to classic..\");\n  }\n  */\n\n  /* https://mozilla-hub.atlassian.net/browse/GENAI-3171\n  clearChat() {\n    console.log(\"open a new chat..\");\n  }\n  */\n\n  getErrorInformation() {\n    if (this.errorStatus === ERROR_TYPES.PAYLOAD_TOO_LARGE) {\n      this.errorText = {\n        header: \"smartwindow-assistant-error-long-message-header\",\n      };\n      // this.actionButton = {\n      //   label: \"smartwindow-clear-btn\",\n      //   action: this.clearChat,\n      // };\n      return;\n    }\n    if (this.errorStatus === ERROR_TYPES.RATE_LIMIT) {\n      this.errorText = {\n        header: \"smartwindow-assistant-error-budget-header\",\n        body: \"smartwindow-assistant-error-budget-body\",\n      };\n      // this.actionButton = {\n      //   label: \"smartwindow-switch-btn\",\n      //   action: this.switchToClassic,\n      // };\n      return;\n    }\n    if (\n      this.errorStatus >= ERROR_TYPES.SERVER_ERROR_MIN &&\n      this.errorStatus <= ERROR_TYPES.SERVER_ERROR_MAX\n    ) {\n      this.actionButton = {\n        label: \"smartwindow-retry-btn\",\n        action: this.retryAssistantMessage.bind(this),\n      };\n    }\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__chatassistanterrorStyles}\"\n      />\n      <div class=\"chat-assistant-error\">\n        <h3\n          class=\"chat-assistant-error__header\"\n          data-l10n-id=${this.errorText?.header}\n        ></h3>\n        ${this.errorText?.body\n          ? html`<p\n              class=\"chat-assistant-error__body\"\n              data-l10n-id=${this.errorText?.body}\n            ></p>`\n          : nothing}\n        ${this.actionButton\n          ? html`<moz-button\n              class=\"chat-assistant-error__button\"\n              data-l10n-id=${this.actionButton?.label}\n              size=\"small\"\n              @click=${this.actionButton?.action}\n            ></moz-button>`\n          : nothing}\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"chat-assistant-error\", ChatAssistantError);\n","import __chrome_styles_loader__assistantmessagefooterStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-footer/assistant-message-footer.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/applied-memories-button.mjs\";\n\n/**\n * AssistantMessageFooter\n *\n * TODO: Currently using placeholder \"Edit Copy\" icon which will be replaced\n * with the copy icon once ready\n *\n * Custom element that renders the footer controls for an assistant message\n * in the AI Window chat UI. The footer includes:\n *   - A copy button for copying the assistant response.\n *   - A retry button for regenerating the response.\n *   - An applied memories button for viewing and/or deleting applied memories.\n *\n * Data updates and network behavior are controlled by its parent.\n *\n * @property {string|null} messageId\n *   Identifier of the assistant message this footer is associated with.\n *\n * @property {Array<object>} appliedMemories\n *   List of applied memories for the message. Passed through to the\n *   <applied-memories-button> child.\n *\n * Events dispatched:\n *   - \"copy-message\"\n *       detail: { messageId }\n *   - \"retry-message\"\n *       detail: { messageId }\n *   - \"retry-without-memories\"\n *       detail: { messageId }\n *   - \"remove-applied-memory\"\n *       (re-dispatched from the applied memories button)\n *       detail: { messageId, index, memory }\n *   - \"toggle-applied-memories\"\n *       (re-dispatched from the applied memories button)\n *       detail: { messageId, open }\n */\nexport class AssistantMessageFooter extends MozLitElement {\n  static properties = {\n    messageId: { type: String, attribute: \"message-id\" },\n    appliedMemories: { attribute: false },\n  };\n\n  constructor() {\n    super();\n    this.messageId = null;\n    this.appliedMemories = [];\n  }\n\n  static eventBehaviors = {\n    bubbles: true,\n    composed: true,\n  };\n\n  static get events() {\n    return {\n      copy: \"copy-message\",\n      retry: \"retry-message\",\n      toggleMemories: \"toggle-applied-memories\",\n      removeMemory: \"remove-applied-memory\",\n      retryWithoutMemories: \"retry-without-memories\",\n    };\n  }\n\n  #emit(type, detail) {\n    this.dispatchEvent(\n      new CustomEvent(type, {\n        ...this.constructor.eventBehaviors,\n        ...(detail !== undefined ? { detail } : {}),\n      })\n    );\n  }\n\n  #emitCopy() {\n    this.#emit(this.constructor.events.copy, { messageId: this.messageId });\n  }\n\n  #emitRetry() {\n    this.#emit(this.constructor.events.retry, { messageId: this.messageId });\n  }\n\n  #onAppliedMemoriesToggle(event) {\n    this.#emit(this.constructor.events.toggleMemories, event.detail);\n  }\n\n  #onRemoveAppliedMemory(event) {\n    this.#emit(this.constructor.events.removeMemory, event.detail);\n  }\n\n  #onRetryWithoutMemories(event) {\n    this.#emit(\n      this.constructor.events.retryWithoutMemories,\n      event.detail ?? { messageId: this.messageId }\n    );\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__assistantmessagefooterStyles}\"\n      />\n      <div class=\"footer\">\n        <moz-button\n          data-l10n-id=\"aiwindow-copy-message\"\n          data-l10n-attrs=\"tooltiptext,aria-label\"\n          class=\"footer-icon-button copy-button\"\n          type=\"ghost\"\n          size=\"small\"\n          iconsrc=\"chrome://global/skin/icons/edit-copy.svg\"\n          @click=${() => {\n            this.#emitCopy();\n          }}\n        >\n        </moz-button>\n        <moz-button\n          data-l10n-id=\"aiwindow-retry\"\n          data-l10n-attrs=\"tooltiptext,aria-label\"\n          type=\"ghost\"\n          size=\"small\"\n          iconsrc=\"chrome://global/skin/icons/reload.svg\"\n          class=\"footer-icon-button retry-button\"\n          @click=${() => {\n            this.#emitRetry();\n          }}\n        >\n        </moz-button>\n        <applied-memories-button\n          .messageId=${this.messageId}\n          .appliedMemories=${this.appliedMemories ?? []}\n          @toggle-applied-memories=${event => {\n            this.#onAppliedMemoriesToggle(event);\n          }}\n          @remove-applied-memory=${event => {\n            this.#onRemoveAppliedMemory(event);\n          }}\n          @retry-without-memories=${event => {\n            this.#onRetryWithoutMemories(event);\n          }}\n        >\n        </applied-memories-button>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"assistant-message-footer\", AssistantMessageFooter);\n","import __chrome_styles_loader__chatassistantloaderStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-loader/chat-assistant-loader.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\n\n/**\n * Loader/spinner visible while the assistant is thinking\n *\n * isSearch - true when this component is being used for loading a search handoff action\n */\nexport class ChatAssistantLoader extends MozLitElement {\n  static properties = {\n    isSearch: { type: Boolean },\n  };\n\n  constructor() {\n    super();\n    this.isSearch = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__chatassistantloaderStyles}\"\n      />\n      <!-- TO DO: add fluent string when UX writing team finished copy - https://bugzilla.mozilla.org/show_bug.cgi?id=2014907 -->\n      <div\n        class=\"chat-assistant-loader\"\n        aria-label=\" ${this.isSearch ? `` : `Loading assistant response`}\"\n      >\n        <span class=\"chat-assistant-loader__spinner\"></span>\n        ${this.isSearch\n          ? html`\n              <p class=\"chat-assistant-loader__text\">Analyzing web search</p>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"chat-assistant-loader\", ChatAssistantLoader);\n","import __chrome_styles_loader__aichatcontentStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/ai-chat-content.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/assistant-message-footer.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/chat-assistant-error.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/chat-assistant-loader.mjs\";\n\n/**\n * A custom element for managing AI Chat Content\n */\nexport class AIChatContent extends MozLitElement {\n  static properties = {\n    assistantIsLoading: { type: Boolean },\n    conversationState: { type: Array },\n    followUpSuggestions: { type: Array },\n    errorStatus: { type: String },\n    isSearching: { type: Boolean },\n    searchQuery: { type: String },\n    showErrorMessage: { type: Boolean },\n    tokens: { type: Object },\n  };\n\n  constructor() {\n    super();\n    this.assistantIsLoading = false;\n    this.conversationState = [];\n    this.errorStatus = null;\n    this.followUpSuggestions = [];\n    this.isSearching = false;\n    this.searchQuery = null;\n    this.showErrorMessage = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.#initEventListeners();\n\n    this.dispatchEvent(\n      new CustomEvent(\"AIChatContent:Ready\", { bubbles: true })\n    );\n    this.#initFooterActionListeners();\n  }\n\n  #dispatchAction(action, detail) {\n    this.dispatchEvent(\n      new CustomEvent(\"AIChatContent:DispatchAction\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          action,\n          ...(detail ?? {}),\n        },\n      })\n    );\n  }\n\n  /**\n   * Initialize event listeners for AI chat content events\n   */\n\n  #initEventListeners() {\n    this.addEventListener(\n      \"aiChatContentActor:message\",\n      this.messageEvent.bind(this)\n    );\n\n    this.addEventListener(\n      \"aiChatContentActor:truncate\",\n      this.truncateEvent.bind(this)\n    );\n\n    this.addEventListener(\n      \"aiChatContentActor:remove-applied-memory\",\n      this.removeAppliedMemoryEvent.bind(this)\n    );\n\n    this.addEventListener(\n      \"aiChatError:retry-message\",\n      this.retryUserMessageAfterError.bind(this)\n    );\n\n    this.addEventListener(\n      \"SmartWindowPrompt:prompt-selected\",\n      this.#onFollowUpSelected.bind(this)\n    );\n  }\n\n  /**\n   * Initialize event listeners for footer actions (retry, copy, etc.)\n   * emitted by child components.\n   */\n\n  #initFooterActionListeners() {\n    this.addEventListener(\"copy-message\", event => {\n      const { messageId } = event.detail ?? {};\n      const text = this.#getAssistantMessageBody(messageId);\n      this.#dispatchAction(\"copy\", { messageId, text });\n    });\n\n    this.addEventListener(\"retry-message\", event => {\n      this.#dispatchAction(\"retry\", event.detail);\n    });\n\n    this.addEventListener(\"retry-without-memories\", event => {\n      this.#dispatchAction(\"retry-without-memories\", event.detail);\n    });\n\n    this.addEventListener(\"remove-applied-memory\", event => {\n      this.#dispatchAction(\"remove-applied-memory\", event.detail);\n    });\n  }\n\n  #getAssistantMessageBody(messageId) {\n    if (!messageId) {\n      return \"\";\n    }\n\n    const msg = this.conversationState.find(m => {\n      return m?.role === \"assistant\" && m?.messageId === messageId;\n    });\n\n    return msg?.body ?? \"\";\n  }\n\n  #onFollowUpSelected(event) {\n    event.stopPropagation();\n    this.followUpSuggestions = [];\n    this.dispatchEvent(\n      new CustomEvent(\"AIChatContent:DispatchFollowUp\", {\n        detail: { text: event.detail.text },\n        bubbles: true,\n      })\n    );\n  }\n\n  messageEvent(event) {\n    const message = event.detail;\n\n    if (message?.content?.isError) {\n      this.handleErrorEvent(message?.content?.status);\n      return;\n    }\n\n    this.showErrorMessage = false;\n    this.#checkConversationState(message);\n\n    switch (message.role) {\n      case \"loading\":\n        this.handleLoadingEvent(event);\n        break;\n      case \"assistant\":\n        this.#checkConversationState(message);\n        this.handleAIResponseEvent(event);\n        break;\n      case \"user\":\n        this.#checkConversationState(message);\n        this.handleUserPromptEvent(event);\n        break;\n      // Used to clear the conversation state via side effects ( new conv id )\n      case \"clear-conversation\":\n        this.#checkConversationState(message);\n    }\n  }\n\n  /**\n   * Check if conversationState needs to be cleared\n   *\n   * @param {ChatMessage} message\n   */\n  #checkConversationState(message) {\n    // Use find/findLast instead of at(0)/at(-1) because\n    // conversationState is a sparse array indexed by ordinal and\n    // at() can land on a hole (undefined) after truncation.\n    const lastMessage = this.conversationState.findLast(m => m);\n    const firstMessage = this.conversationState.find(m => m);\n    const isReloadingSameConvo =\n      firstMessage &&\n      firstMessage.convId === message.convId &&\n      firstMessage.ordinal === message.ordinal;\n    const convIdChanged = message.convId !== lastMessage?.convId;\n\n    // If the conversation ID has changed, reset the conversation state\n    if (convIdChanged || isReloadingSameConvo) {\n      this.conversationState = [];\n    }\n  }\n\n  handleLoadingEvent(event) {\n    const { isSearching } = event.detail;\n    this.isSearching = !!isSearching;\n    this.assistantIsLoading = true;\n    this.requestUpdate();\n    this.#scrollToBottom();\n  }\n\n  handleErrorEvent(errorStatus) {\n    this.assistantIsLoading = false;\n    this.isSearching = false;\n    this.errorStatus = errorStatus;\n    this.showErrorMessage = true;\n    this.requestUpdate();\n  }\n\n  /**\n   *  Handle user prompt events\n   *\n   * @param {CustomEvent} event - The custom event containing the user prompt\n   */\n\n  handleUserPromptEvent(event) {\n    this.followUpSuggestions = [];\n    const { convId, content, ordinal } = event.detail;\n    this.assistantIsLoading = true;\n    this.conversationState[ordinal] = {\n      role: \"user\",\n      body: content.body,\n      convId,\n      ordinal,\n    };\n    this.requestUpdate();\n    this.#scrollToBottom();\n  }\n\n  retryUserMessageAfterError() {\n    const lastMessage = this.conversationState.at(-1);\n    this.#dispatchAction(\"retry-after-error\", {\n      ...lastMessage,\n      content: { type: \"text\", body: lastMessage.body },\n    });\n  }\n\n  /**\n   * Handle AI response events\n   *\n   * @param {CustomEvent} event - The custom event containing the response\n   */\n\n  handleAIResponseEvent(event) {\n    this.isSearching = false;\n    this.assistantIsLoading = false;\n\n    const {\n      convId,\n      ordinal,\n      id: messageId,\n      content,\n      memoriesApplied,\n      tokens,\n      webSearchQueries,\n    } = event.detail;\n\n    if (typeof content.body !== \"string\" || !content.body) {\n      return;\n    }\n\n    // The \"webSearchQueries\" are coming from a conversation that is being initialized\n    // and \"tokens\" are streaming in from a live conversation.\n    const searchTokens = webSearchQueries ?? tokens?.search ?? [];\n\n    // Prefer showing web search handoff over followup suggestions.\n    this.followUpSuggestions = searchTokens.length\n      ? []\n      : (tokens?.followup ?? []).slice(0, 2);\n\n    this.conversationState[ordinal] = {\n      role: \"assistant\",\n      convId,\n      messageId,\n      body: content.body,\n      appliedMemories: memoriesApplied ?? [],\n      searchTokens,\n    };\n\n    this.requestUpdate();\n  }\n\n  #scrollToBottom() {\n    this.updateComplete.then(() => {\n      const wrapper = this.shadowRoot?.querySelector(\".chat-content-wrapper\");\n      wrapper?.lastElementChild?.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"end\",\n      });\n    });\n  }\n\n  truncateEvent(event) {\n    const { messageId } = event.detail ?? {};\n    if (!messageId) {\n      return;\n    }\n\n    const idx = this.conversationState.findIndex(m => {\n      return m?.role === \"assistant\" && m?.messageId === messageId;\n    });\n\n    if (idx === -1) {\n      return;\n    }\n\n    this.conversationState = this.conversationState.slice(0, idx);\n    this.requestUpdate();\n  }\n\n  removeAppliedMemoryEvent(event) {\n    const { messageId, memoryId } = event.detail ?? {};\n    const msg = this.conversationState.find(m => {\n      return m?.role === \"assistant\" && m?.messageId === messageId;\n    });\n\n    msg.appliedMemories = msg.appliedMemories.filter(\n      memory => memory?.id !== memoryId\n    );\n    this.requestUpdate();\n  }\n\n  #renderMessage(msg) {\n    if (!msg) {\n      return nothing;\n    }\n    return html`\n      <div class=${`chat-bubble chat-bubble-${msg.role}`}>\n        <ai-chat-message\n          .message=${msg.body}\n          .role=${msg.role}\n          .searchTokens=${msg.searchTokens || []}\n        ></ai-chat-message>\n        ${msg.role === \"assistant\"\n          ? html`\n              <assistant-message-footer\n                .messageId=${msg.messageId}\n                .appliedMemories=${msg.appliedMemories}\n              ></assistant-message-footer>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  #renderFollowUpSuggestions() {\n    if (!this.followUpSuggestions?.length) {\n      return nothing;\n    }\n    return html`<smartwindow-prompts\n      .prompts=${this.followUpSuggestions.map(text => ({\n        text,\n        type: \"followup\",\n      }))}\n      mode=\"followup\"\n    ></smartwindow-prompts>`;\n  }\n\n  #renderLoader() {\n    if (!this.assistantIsLoading) {\n      return nothing;\n    }\n    return html`<chat-assistant-loader\n      .isSearch=${this.isSearching}\n    ></chat-assistant-loader>`;\n  }\n\n  #renderError() {\n    if (!this.showErrorMessage) {\n      return nothing;\n    }\n    return html`<chat-assistant-error\n      .errorStatus=${this.errorStatus}\n    ></chat-assistant-error>`;\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__aichatcontentStyles}\"\n      />\n      <div class=\"chat-content-wrapper\">\n        ${this.conversationState.map(msg => this.#renderMessage(msg))}\n        ${this.#renderFollowUpSuggestions()} ${this.#renderLoader()}\n        ${this.#renderError()}\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"ai-chat-content\", AIChatContent);\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport \"chrome://browser/content/aiwindow/components/ai-chat-content.mjs\";\n\nexport default {\n  title: \"Domain-specific UI Widgets/AI Window/AI Chat Content\",\n  component: \"ai-chat-content\",\n  argTypes: {\n    conversationState: { control: { type: \"object\" } },\n  },\n  parameters: {\n    fluent: `\naiwindow-memories-used =\n  .label = Memories used\naiwindow-retry-without-memories =\n  .label = Retry without memories\naiwindow-retry =\n  .tooltiptext = Retry\naiwindow-copy-message =\n  .tooltiptext = Copy\n    `,\n  },\n};\n\nconst Template = ({ conversationState }) => html`\n  <ai-chat-content .conversationState=${conversationState}></ai-chat-content>\n`;\n\nexport const Empty = Template.bind({});\nEmpty.args = { conversationState: [] };\n\nexport const SingleUserMessage = Template.bind({});\nSingleUserMessage.args = {\n  conversationState: [\n    { role: \"user\", body: \"What is the weather like today?\" },\n  ],\n};\n\nexport const Conversation = Template.bind({});\nConversation.args = {\n  conversationState: [\n    { role: \"user\", body: \"What is the weather like today?\" },\n    {\n      role: \"assistant\",\n      messageId: \"a1\",\n      body: \"I don't have access to real-time weather data, but I can help you with other tasks!\",\n      appliedMemories: [],\n    },\n    { role: \"user\", body: \"Can you help me with coding?\" },\n    {\n      role: \"assistant\",\n      messageId: \"a2\",\n      body: \"Yes, I can help you with coding! What programming language or problem are you working on?\",\n      appliedMemories: [\n        \"Looking for help with coding\",\n        \"Looking for real time weather data\",\n      ],\n    },\n  ],\n};\n"],"names":[],"sourceRoot":""}