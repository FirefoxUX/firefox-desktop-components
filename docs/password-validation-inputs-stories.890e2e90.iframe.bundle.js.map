{"version":3,"file":"password-validation-inputs-stories.890e2e90.iframe.bundle.js","mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;AClIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;;AAEA;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClIA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAGA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAMA;AAGA;AACA;AAGA;AAKA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA","sources":["webpack:///../backup/content/password-rules-tooltip.mjs","webpack:///../backup/content/password-validation-inputs.stories.mjs","webpack:///../../../toolkit/content/widgets/moz-card/moz-card.mjs","webpack:///../backup/content/password-validation-inputs.mjs"],"sourcesContent":["import __chrome_styles_loader__passwordrulestooltipStyles from \"browser/components/backup/content/password-rules-tooltip.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n\n/**\n * The widget for enabling password protection if the backup is not yet\n * encrypted.\n */\nexport default class PasswordRulesTooltip extends MozLitElement {\n  static properties = {\n    hasEmail: { type: Boolean },\n    tooShort: { type: Boolean },\n    open: { type: Boolean },\n  };\n\n  static get queries() {\n    return {\n      passwordRulesEl: \"#password-rules-wrapper\",\n    };\n  }\n\n  constructor() {\n    super();\n    this.hasEmail = false;\n    this.tooShort = false;\n    this._onResize = null;\n  }\n\n  _debounce(fn, delay) {\n    let timeout;\n    return (...args) => {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => fn(...args), delay);\n    };\n  }\n\n  _handleResize() {\n    if (this.open) {\n      this.positionPopover();\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._onResize = this._debounce(() => this._handleResize(), 200);\n    window.addEventListener(\"resize\", this._onResize);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._onResize) {\n      window.removeEventListener(\"resize\", this._onResize);\n    }\n  }\n\n  show() {\n    this.passwordRulesEl.showPopover();\n    this.positionPopover();\n  }\n\n  hide() {\n    this.passwordRulesEl.hidePopover();\n  }\n\n  positionPopover() {\n    const anchorRect = this.getBoundingClientRect();\n    const isWideViewport = window.innerWidth >= 1200;\n\n    const leftPos = anchorRect.left;\n    if (isWideViewport) {\n      // Position to the right of the input\n      const topPos = anchorRect.top;\n\n      this.passwordRulesEl.style.left = `${leftPos}px`;\n      this.passwordRulesEl.style.top = `${topPos}px`;\n    } else {\n      // Position below the input\n      const topPos = anchorRect.bottom;\n\n      this.passwordRulesEl.style.left = `${leftPos}px`;\n      this.passwordRulesEl.style.top = `${topPos}px`;\n    }\n  }\n\n  _onBeforeToggle(e) {\n    this.open = e.newState == \"open\";\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__passwordrulestooltipStyles}\"\n      />\n      <div\n        id=\"password-rules-wrapper\"\n        role=\"tooltip\"\n        aria-describedby=\"password-rules-header\"\n        popover=\"manual\"\n        @beforetoggle=${this._onBeforeToggle}\n      >\n        <h2\n          id=\"password-rules-header\"\n          data-l10n-id=\"password-rules-header\"\n        ></h2>\n        <ul>\n          <li class=${this.tooShort && \"warning\"}>\n            <span\n              data-l10n-id=\"password-rules-length-description\"\n              class=\"rule-description\"\n              aria-labelledby=\"password-rules-header\"\n            ></span>\n          </li>\n          <li class=${this.hasEmail && \"warning\"}>\n            <span\n              data-l10n-id=\"password-rules-email-description\"\n              class=\"rule-description\"\n              aria-labelledby=\"password-rules-header\"\n            ></span>\n          </li>\n        </ul>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"password-rules-tooltip\", PasswordRulesTooltip);\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n// eslint-disable-next-line import/no-unresolved\nimport { html } from \"lit.all.mjs\";\nimport \"chrome://global/content/elements/moz-card.mjs\";\nimport \"./password-validation-inputs.mjs\";\n\nwindow.MozXULElement.insertFTLIfNeeded(\"browser/backupSettings.ftl\");\nwindow.MozXULElement.insertFTLIfNeeded(\"branding/brand.ftl\");\n\nexport default {\n  title: \"Domain-specific UI Widgets/Backup/Password Inputs\",\n  component: \"password-validation-inputs\",\n  argTypes: {},\n};\n\nconst Template = () => html`\n  <moz-card style=\"position: relative; width: 25rem;\">\n    <password-validation-inputs></password-validation-inputs>\n  </moz-card>\n`;\n\nexport const Default = Template.bind({});\n","import __chrome_styles_loader__mozcardStyles from \"toolkit/content/widgets/moz-card/moz-card.css\";\n/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport {\n  html,\n  ifDefined,\n  when,\n} from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n\n/**\n * Cards contain content and actions about a single subject.\n * There are two card types:\n * The default type where no type attribute is required and the card\n * will have no extra functionality.\n *\n * The \"accordion\" type will initially not show any content. The card\n * will contain an arrow to expand the card so that all of the content\n * is visible. You can use the \"expanded\" attribute to force the accordion\n * card to show its content on initial render.\n *\n * @property {string} heading - The heading text that will be used for the card.\n * @property {string} iconSrc - Path to the icon that should be displayed in the card.\n * @property {string} type - (optional) The type of card. No type specified\n *   will be the default card. The other available type is \"accordion\"\n * @property {boolean} expanded - A flag to indicate whether the card is\n *  expanded or not. Can be used to expand the content section of the\n *  accordion card on initial render.\n * @slot content - The content to show inside of the card.\n */\nexport default class MozCard extends MozLitElement {\n  static queries = {\n    detailsEl: \"#moz-card-details\",\n    headingEl: \"#heading\",\n    contentEl: \"#content\",\n    summaryEl: \"summary\",\n    contentSlotEl: \"#content-slot\",\n  };\n\n  static properties = {\n    heading: { type: String, fluent: true },\n    iconSrc: { type: String },\n    type: { type: String, reflect: true },\n    expanded: { type: Boolean },\n  };\n\n  constructor() {\n    super();\n    this.type = \"default\";\n    this.expanded = false;\n  }\n\n  headingTemplate() {\n    if (!this.heading) {\n      return \"\";\n    }\n    return html`\n      <div id=\"heading-wrapper\" part=\"moz-card-heading-wrapper\">\n        ${when(\n          this.type == \"accordion\",\n          () => html`<div class=\"chevron-icon\"></div>`\n        )}\n        ${when(\n          !!this.iconSrc,\n          () =>\n            html`<img\n              id=\"heading-icon\"\n              src=${this.iconSrc}\n              role=\"presentation\"\n            />`\n        )}\n        <span id=\"heading\" title=${ifDefined(this.heading)} part=\"heading\"\n          >${this.heading}</span\n        >\n      </div>\n    `;\n  }\n\n  cardTemplate() {\n    if (this.type === \"accordion\") {\n      return html`\n        <details\n          id=\"moz-card-details\"\n          @toggle=${this.onToggle}\n          ?open=${this.expanded}\n        >\n          <summary part=\"summary\">${this.headingTemplate()}</summary>\n          <div id=\"content\"><slot id=\"content-slot\"></slot></div>\n        </details>\n      `;\n    }\n\n    return html`\n      <div id=\"moz-card-details\">\n        ${this.headingTemplate()}\n        <div id=\"content\" aria-describedby=\"content\">\n          <slot></slot>\n        </div>\n      </div>\n    `;\n  }\n\n  onToggle() {\n    this.expanded = this.detailsEl.open;\n    this.dispatchEvent(\n      new ToggleEvent(\"toggle\", {\n        newState: this.detailsEl.open ? \"open\" : \"closed\",\n        oldState: this.detailsEl.open ? \"closed\" : \"open\",\n      })\n    );\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__mozcardStyles}\"\n      />\n      <article\n        class=\"moz-card\"\n        aria-labelledby=${ifDefined(this.heading ? \"heading\" : undefined)}\n      >\n        ${this.cardTemplate()}\n      </article>\n    `;\n  }\n}\ncustomElements.define(\"moz-card\", MozCard);\n","import __chrome_styles_loader__passwordvalidationinputsStyles from \"browser/components/backup/content/password-validation-inputs.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/backup/password-rules-tooltip.mjs\";\n\n/**\n * The widget for enabling password protection if the backup is not yet\n * encrypted.\n */\nexport default class PasswordValidationInputs extends MozLitElement {\n  static properties = {\n    _hasEmail: { type: Boolean, state: true },\n    _passwordsMatch: { type: Boolean, state: true },\n    _passwordsValid: { type: Boolean, state: true },\n    _tooShort: { type: Boolean, state: true },\n    createPasswordLabelL10nId: {\n      type: String,\n      reflect: true,\n      attribute: \"create-password-label-l10n-id\",\n    },\n    embeddedFxBackupOptIn: {\n      type: Boolean,\n      reflect: true,\n      attribute: \"embedded-fx-backup-opt-in\",\n    },\n  };\n\n  static get queries() {\n    return {\n      formEl: \"#password-inputs-form\",\n      inputNewPasswordEl: \"#new-password-input\",\n      inputRepeatPasswordEl: \"#repeat-password-input\",\n      passwordRulesEl: \"#password-rules\",\n      repeatPasswordErrorEl: \"#repeat-password-error\",\n    };\n  }\n\n  constructor() {\n    super();\n    this._tooShort = true;\n    this._hasEmail = false;\n    this._passwordsMatch = false;\n    this._passwordsValid = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._onKeydown = e => {\n      if (e.key === \"Escape\" && this.passwordRulesEl.open) {\n        this.passwordRulesEl.hide();\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    };\n    document.addEventListener(\"keydown\", this._onKeydown, true);\n  }\n  disconnectedCallback() {\n    document.removeEventListener(\"keydown\", this._onKeydown, true);\n    super.disconnectedCallback();\n  }\n\n  setInputValidity(input, isValid, describedById = null) {\n    input.setAttribute(\"aria-invalid\", isValid ? \"false\" : \"true\");\n    if (describedById) {\n      input.setAttribute(\"aria-describedby\", describedById);\n    } else {\n      input.removeAttribute(\"aria-describedby\");\n    }\n  }\n\n  reset() {\n    this.formEl?.reset();\n    if (this.inputNewPasswordEl) {\n      this.inputNewPasswordEl.revealPassword = false;\n      this.setInputValidity(this.inputNewPasswordEl, true);\n    }\n    if (this.inputRepeatPasswordEl) {\n      this.inputRepeatPasswordEl.revealPassword = false;\n      this.setInputValidity(this.inputRepeatPasswordEl, true);\n    }\n    this._hasEmail = false;\n    this._tooShort = true;\n    this._passwordsMatch = false;\n    this._passwordsValid = false;\n  }\n\n  handleFocusNewPassword() {\n    this.passwordRulesEl.show();\n  }\n\n  handleBlurNewPassword(event) {\n    if (event.target.checkValidity()) {\n      this.passwordRulesEl.hide();\n    }\n  }\n\n  handleChangeNewPassword() {\n    this.updatePasswordValidity();\n  }\n\n  handleChangeRepeatPassword() {\n    this.updatePasswordValidity();\n  }\n\n  updatePasswordValidity() {\n    const emailRegex = /^[\\w!#$%&'*+/=?^`{|}~.-]+@[A-Z0-9-]+\\.[A-Z0-9.-]+$/i;\n    const l10n = new Localization([\"browser/backupSettings.ftl\"], true);\n\n    this._hasEmail = emailRegex.test(this.inputNewPasswordEl.value);\n    if (this._hasEmail) {\n      const invalid_password_email_l10n_message = l10n.formatValueSync(\n        \"password-validity-has-email\"\n      );\n\n      this.inputNewPasswordEl.setCustomValidity(\n        invalid_password_email_l10n_message\n      );\n    } else {\n      this.inputNewPasswordEl.setCustomValidity(\"\");\n    }\n\n    const newPassValidity = this.inputNewPasswordEl.validity;\n    this._tooShort = newPassValidity?.valueMissing || newPassValidity?.tooShort;\n\n    const newInvalid = !newPassValidity?.valid;\n    this.setInputValidity(\n      this.inputNewPasswordEl,\n      !newInvalid,\n      \"password-rules-tooltip\"\n    );\n\n    this._passwordsMatch =\n      this.inputNewPasswordEl.value == this.inputRepeatPasswordEl.value;\n\n    if (!this._passwordsMatch) {\n      this.inputRepeatPasswordEl.setCustomValidity(\n        l10n.formatValueSync(\"password-validity-do-not-match\")\n      );\n      this.setInputValidity(\n        this.inputRepeatPasswordEl,\n        false,\n        \"repeat-password-error\"\n      );\n      document.l10n.setAttributes(\n        this.repeatPasswordErrorEl,\n        \"password-validity-do-not-match\"\n      );\n    } else {\n      this.inputRepeatPasswordEl.setCustomValidity(\"\");\n      this.setInputValidity(this.inputRepeatPasswordEl, true);\n    }\n\n    const repeatPassValidity = this.inputRepeatPasswordEl.validity;\n    this._passwordsValid =\n      newPassValidity?.valid &&\n      repeatPassValidity?.valid &&\n      this._passwordsMatch;\n  }\n\n  /**\n   * Dispatches a custom event whenever validity changes.\n   *\n   * @param {Map<string, any>} changedProperties a Map of recently changed properties and their new values\n   */\n  updated(changedProperties) {\n    if (!changedProperties.has(\"_passwordsValid\")) {\n      return;\n    }\n\n    if (this._passwordsValid) {\n      this.dispatchEvent(\n        new CustomEvent(\"ValidPasswordsDetected\", {\n          bubbles: true,\n          composed: true,\n          detail: {\n            password: this.inputNewPasswordEl.value,\n          },\n        })\n      );\n    } else {\n      this.dispatchEvent(\n        new CustomEvent(\"InvalidPasswordsDetected\", {\n          bubbles: true,\n          composed: true,\n        })\n      );\n    }\n  }\n\n  contentTemplate() {\n    return html`\n      <div id=\"password-inputs-wrapper\" aria-live=\"polite\">\n        <form id=\"password-inputs-form\">\n          <!--TODO: (bug 1909983) change first input field label for the \"change-password\" dialog-->\n          <label id=\"new-password-label\" for=\"new-password-input\">\n            <div id=\"new-password-label-wrapper-span-input\">\n              <span\n                id=\"new-password-span\"\n                data-l10n-id=${this.createPasswordLabelL10nId ||\n                \"enable-backup-encryption-create-password-label\"}\n              ></span>\n              <input\n                type=\"password\"\n                id=\"new-password-input\"\n                minlength=\"8\"\n                required\n                aria-describedby=\"password-rules-tooltip\"\n                @input=${this.handleChangeNewPassword}\n                @blur=${this.handleBlurNewPassword}\n                @mouseenter=${this.handleFocusNewPassword}\n                @focus=${this.handleFocusNewPassword}\n              />\n              <!--TODO: (bug 1909984) improve how we read out the first input field for screen readers-->\n            </div>\n          </label>\n          <!--TODO: (bug 1909984) look into how the tooltip vs dialog behaves when pressing the ESC key-->\n          <password-rules-tooltip\n            id=\"password-rules\"\n            role=\"tooltip\"\n            .hasEmail=${this._hasEmail}\n            .tooShort=${this._tooShort}\n            ?embedded-fx-backup-opt-in=${this.embeddedFxBackupOptIn}\n          ></password-rules-tooltip>\n          <label id=\"repeat-password-label\" for=\"repeat-password-input\">\n            <span\n              id=\"repeat-password-span\"\n              data-l10n-id=\"enable-backup-encryption-repeat-password-label\"\n            ></span>\n            <input\n              type=\"password\"\n              id=\"repeat-password-input\"\n              required\n              @input=${this.handleChangeRepeatPassword}\n            />\n            <span\n              id=\"repeat-password-error\"\n              role=\"alert\"\n              class=\"field-error\"\n            ></span>\n          </label>\n        </form>\n      </div>\n    `;\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__passwordvalidationinputsStyles}\"\n      />\n      ${this.contentTemplate()}\n    `;\n  }\n}\n\ncustomElements.define(\"password-validation-inputs\", PasswordValidationInputs);\n"],"names":[],"sourceRoot":""}