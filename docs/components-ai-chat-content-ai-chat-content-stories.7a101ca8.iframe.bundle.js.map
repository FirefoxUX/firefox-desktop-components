{"version":3,"file":"components-ai-chat-content-ai-chat-content-stories.7a101ca8.iframe.bundle.js","mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;AC3PA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;AC1JA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3HA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAIA;AAEA","sources":["webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-footer/applied-memories-button.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/chat-assistant-footer/assistant-message-footer.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/ai-chat-content.mjs","webpack:///../aiwindow/ui/components/ai-chat-content/ai-chat-content.stories.mjs"],"sourcesContent":["import __chrome_styles_loader__appliedmemoriesbuttonStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-footer/applied-memories-button.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\n\n/**\n * AppliedMemoriesButton\n *\n * TODO: Currently using placeholder \"Highlights\" icon which will be replaced\n * with the memories icon once ready\n *\n * Custom element that renders the “Memories applied” pill and popover for\n * a single assistant message. The popover shows a list of applied\n * memories and allows the user to:\n *   - Remove an individual applied memory.\n *   - Retry the message without any applied memories.\n *\n * @property {string|null} messageId\n *   Identifier for the assistant message this control belongs to.\n *\n * @property {Array<object>} appliedMemories\n *   List of applied memories for the message. The component will render up\n *   to the first 5 items in the popover.\n *\n * @property {boolean} open\n *   Whether the popover is currently open. This is typically controlled\n *   internally when the button is clicked and also reflected via the\n *   \"toggle-applied-memories\" event.\n *\n * Events dispatched:\n *   - \"toggle-applied-memories\"\n *       detail: { messageId, open }\n *   - \"remove-applied-memory\"\n *       detail: { messageId, index, memory }\n *   - \"retry-without-memories\"\n *       detail: { messageId }\n */\nexport class AppliedMemoriesButton extends MozLitElement {\n  static properties = {\n    messageId: { type: String, attribute: \"message-id\" },\n    appliedMemories: { attribute: false },\n    open: { type: Boolean, reflect: false },\n  };\n\n  constructor() {\n    super();\n    this.messageId = null;\n    this.appliedMemories = [];\n    this.open = false;\n\n    this._onDocumentClick = this._onDocumentClick.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    document.addEventListener(\"click\", this._onDocumentClick);\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener(\"click\", this._onDocumentClick);\n    super.disconnectedCallback();\n  }\n\n  get _hasMemories() {\n    return Array.isArray(this.appliedMemories) && !!this.appliedMemories.length;\n  }\n\n  get _visibleMemories() {\n    return this.appliedMemories.slice(0, 5);\n  }\n\n  #onTriggerClick(event) {\n    event.stopPropagation();\n    if (!this._hasMemories) {\n      return;\n    }\n\n    this.open = !this.open;\n    this.toggleAttribute(\"data-open\", this.open);\n\n    this.dispatchEvent(\n      new CustomEvent(\"toggle-applied-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n          open: this.open,\n        },\n      })\n    );\n  }\n\n  _onPopoverClick(event) {\n    event.stopPropagation();\n  }\n\n  _onDocumentClick() {\n    if (!this.open) {\n      return;\n    }\n    this.open = false;\n    this.toggleAttribute(\"data-open\", false);\n    this.requestUpdate();\n\n    this.dispatchEvent(\n      new CustomEvent(\"toggle-applied-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n          open: false,\n        },\n      })\n    );\n  }\n\n  _onRemoveMemory(event, index) {\n    event.stopPropagation();\n\n    if (!Array.isArray(this.appliedMemories)) {\n      return;\n    }\n\n    const memory = this.appliedMemories[index];\n\n    // Remove memory visually, but update will be done by parent\n    this.appliedMemories = this.appliedMemories.filter((_, i) => {\n      return i !== index;\n    });\n\n    this.dispatchEvent(\n      new CustomEvent(\"remove-applied-memory\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n          index,\n          memory,\n        },\n      })\n    );\n  }\n\n  _onRetryWithoutMemories(event) {\n    event.stopPropagation();\n\n    this.dispatchEvent(\n      new CustomEvent(\"retry-without-memories\", {\n        bubbles: true,\n        composed: true,\n        detail: {\n          messageId: this.messageId,\n        },\n      })\n    );\n  }\n\n  // TODO: Update formatting function once shape of memories passed is confirmed\n  _formatMemoryLabel(memory) {\n    if (typeof memory === \"string\") {\n      return memory;\n    }\n    return \"\";\n  }\n\n  renderPopover() {\n    if (!this._hasMemories) {\n      return nothing;\n    }\n\n    const isOpen = this.open;\n    const visibleMemories = this._visibleMemories;\n\n    return html`\n      <div\n        class=\"popover ${isOpen ? \"open\" : \"\"}\"\n        role=\"region\"\n        aria-hidden=${!isOpen}\n        @click=${event => this._onPopoverClick(event)}\n      >\n        <ul class=\"memories-list\">\n          ${visibleMemories.map((memory, index) => {\n            const label = this._formatMemoryLabel(memory);\n            if (!label) {\n              return nothing;\n            }\n\n            // @todo Bug 2010069\n            // Localize aria-label\n            return html`\n              <li class=\"memories-list-item\">\n                <span class=\"memories-list-label\">${label}</span>\n                <moz-button\n                  class=\"memories-remove-button\"\n                  type=\"ghost\"\n                  size=\"small\"\n                  iconsrc=\"chrome://global/skin/icons/close.svg\"\n                  aria-label=\"Remove this memory\"\n                  @click=${event => this._onRemoveMemory(event, index)}\n                ></moz-button>\n              </li>\n            `;\n          })}\n        </ul>\n\n        <div class=\"retry-row\">\n          <moz-button\n            type=\"ghost\"\n            size=\"default\"\n            iconsrc=\"chrome://global/skin/icons/reload.svg\"\n            iconposition=\"start\"\n            class=\"retry-row-button\"\n            data-l10n-id=\"aiwindow-retry-without-memories\"\n            data-l10n-attrs=\"label\"\n          ></moz-button>\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    if (!this._hasMemories) {\n      return null;\n    }\n\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__appliedmemoriesbuttonStyles}\"\n      />\n      <moz-button\n        class=\"memories-trigger\"\n        type=\"ghost\"\n        size=\"small\"\n        iconposition=\"start\"\n        iconsrc=\"chrome://global/skin/icons/highlights.svg\"\n        aria-haspopup=\"dialog\"\n        aria-expanded=${this.open && this._hasMemories}\n        data-l10n-id=\"aiwindow-memories-used\"\n        data-l10n-attrs=\"label\"\n        @click=${event => this.#onTriggerClick(event)}\n      ></moz-button>\n\n      ${this.renderPopover()}\n    `;\n  }\n}\n\ncustomElements.define(\"applied-memories-button\", AppliedMemoriesButton);\n","import __chrome_styles_loader__assistantmessagefooterStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/chat-assistant-footer/assistant-message-footer.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/applied-memories-button.mjs\";\n\n/**\n * AssistantMessageFooter\n *\n * TODO: Currently using placeholder \"Edit Copy\" icon which will be replaced\n * with the copy icon once ready\n *\n * Custom element that renders the footer controls for an assistant message\n * in the AI Window chat UI. The footer includes:\n *   - A copy button for copying the assistant response.\n *   - A retry button for regenerating the response.\n *   - An applied memories button for viewing and/or deleting applied memories.\n *\n * Data updates and network behavior are controlled by its parent.\n *\n * @property {string|null} messageId\n *   Identifier of the assistant message this footer is associated with.\n *\n * @property {Array<object>} appliedMemories\n *   List of applied memories for the message. Passed through to the\n *   <applied-memories-button> child.\n *\n * Events dispatched:\n *   - \"copy-message\"\n *       detail: { messageId }\n *   - \"retry-message\"\n *       detail: { messageId }\n *   - \"retry-without-memories\"\n *       detail: { messageId }\n *   - \"remove-applied-memory\"\n *       (re-dispatched from the applied memories button)\n *       detail: { messageId, index, memory }\n *   - \"toggle-applied-memories\"\n *       (re-dispatched from the applied memories button)\n *       detail: { messageId, open }\n */\nexport class AssistantMessageFooter extends MozLitElement {\n  static properties = {\n    messageId: { type: String, attribute: \"message-id\" },\n    appliedMemories: { attribute: false },\n  };\n\n  constructor() {\n    super();\n    this.messageId = null;\n    this.appliedMemories = [];\n  }\n\n  static eventBehaviors = {\n    bubbles: true,\n    composed: true,\n  };\n\n  static get events() {\n    return {\n      copy: \"copy-message\",\n      retry: \"retry-message\",\n      toggleMemories: \"toggle-applied-memories\",\n      removeMemory: \"remove-applied-memory\",\n      retryWithoutMemories: \"retry-without-memories\",\n    };\n  }\n\n  #emit(type, detail) {\n    this.dispatchEvent(\n      new CustomEvent(type, {\n        ...this.constructor.eventBehaviors,\n        ...(detail !== undefined ? { detail } : {}),\n      })\n    );\n  }\n\n  #emitCopy() {\n    this.#emit(this.constructor.events.copy, { messageId: this.messageId });\n  }\n\n  #emitRetry() {\n    this.#emit(this.constructor.events.retry, { messageId: this.messageId });\n  }\n\n  #onAppliedMemoriesToggle(event) {\n    this.#emit(this.constructor.events.toggleMemories, event.detail);\n  }\n\n  #onRemoveAppliedMemory(event) {\n    this.#emit(this.constructor.events.removeMemory, event.detail);\n  }\n\n  #onRetryWithoutMemories(event) {\n    this.#emit(\n      this.constructor.events.retryWithoutMemories,\n      event.detail ?? { messageId: this.messageId }\n    );\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__assistantmessagefooterStyles}\"\n      />\n      <div class=\"footer\">\n        <moz-button\n          data-l10n-id=\"aiwindow-copy-message\"\n          data-l10n-attrs=\"tooltiptext,aria-label\"\n          class=\"footer-icon-button copy-button\"\n          type=\"ghost\"\n          size=\"small\"\n          iconsrc=\"chrome://global/skin/icons/edit-copy.svg\"\n          @click=${() => {\n            this.#emitCopy();\n          }}\n        >\n        </moz-button>\n        <moz-button\n          data-l10n-id=\"aiwindow-retry\"\n          data-l10n-attrs=\"tooltiptext,aria-label\"\n          type=\"ghost\"\n          size=\"small\"\n          iconsrc=\"chrome://global/skin/icons/reload.svg\"\n          class=\"footer-icon-button retry-button\"\n          @click=${() => {\n            this.#emitRetry();\n          }}\n        >\n        </moz-button>\n        <applied-memories-button\n          .messageId=${this.messageId}\n          .appliedMemories=${this.appliedMemories ?? []}\n          @toggle-applied-memories=${event => {\n            this.#onAppliedMemoriesToggle(event);\n          }}\n          @remove-applied-memory=${event => {\n            this.#onRemoveAppliedMemory(event);\n          }}\n          @retry-without-memories=${event => {\n            this.#onRetryWithoutMemories(event);\n          }}\n        >\n        </applied-memories-button>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"assistant-message-footer\", AssistantMessageFooter);\n","import __chrome_styles_loader__aichatcontentStyles from \"browser/components/aiwindow/ui/components/ai-chat-content/ai-chat-content.css\";\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { html, nothing } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport { MozLitElement } from \"chrome://global/content/lit-utils.mjs\";\n// eslint-disable-next-line import/no-unassigned-import\nimport \"chrome://browser/content/aiwindow/components/assistant-message-footer.mjs\";\n\n/**\n * A custom element for managing AI Chat Content\n */\nexport class AIChatContent extends MozLitElement {\n  static properties = {\n    conversationState: { type: Array },\n    tokens: { type: Object },\n  };\n\n  constructor() {\n    super();\n    this.conversationState = [];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.#initEventListeners();\n  }\n\n  /**\n   * Initialize event listeners for AI chat content events\n   */\n\n  #initEventListeners() {\n    this.addEventListener(\n      \"aiChatContentActor:message\",\n      this.messageEvent.bind(this)\n    );\n  }\n\n  messageEvent(event) {\n    const message = event.detail;\n    if (message.role === \"assistant\") {\n      this.handleAIResponseEvent(event);\n      return;\n    }\n    this.handleUserPromptEvent(event);\n  }\n\n  /**\n   *  Handle user prompt events\n   *\n   * @param {CustomEvent} event - The custom event containing the user prompt\n   */\n\n  handleUserPromptEvent(event) {\n    const { content } = event.detail;\n    this.conversationState.push({\n      role: \"user\",\n      body: content.body,\n    });\n    this.requestUpdate();\n  }\n\n  /**\n   * Handle AI response events\n   *\n   * @param {CustomEvent} event - The custom event containing the response\n   */\n\n  handleAIResponseEvent(event) {\n    // TODO (bug 2009434): update reference to insights\n    const {\n      ordinal,\n      id: messageId,\n      content,\n      memoriesApplied,\n      tokens,\n    } = event.detail;\n\n    this.conversationState[ordinal] = {\n      role: \"assistant\",\n      messageId,\n      body: content.body,\n      appliedMemories: memoriesApplied ?? [],\n      searchTokens: tokens?.search || [],\n    };\n\n    this.requestUpdate();\n  }\n\n  render() {\n    return html`\n      <link\n        rel=\"stylesheet\"\n        href=\"${__chrome_styles_loader__aichatcontentStyles}\"\n      />\n      <div class=\"chat-content-wrapper\">\n        ${this.conversationState.map(msg => {\n          return html`\n            <div class=${`chat-bubble chat-bubble-${msg.role}`}>\n              <ai-chat-message\n                .message=${msg.body}\n                .role=${msg.role}\n                .searchTokens=${msg.searchTokens || []}\n              ></ai-chat-message>\n\n              ${msg.role === \"assistant\"\n                ? html`\n                    <assistant-message-footer\n                      .messageId=${msg.messageId}\n                      .appliedMemories=${msg.appliedMemories}\n                    ></assistant-message-footer>\n                  `\n                : nothing}\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"ai-chat-content\", AIChatContent);\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\n\nimport { html } from \"chrome://global/content/vendor/lit.all.mjs\";\nimport \"chrome://browser/content/aiwindow/components/ai-chat-content.mjs\";\n\nexport default {\n  title: \"Domain-specific UI Widgets/AI Window/AI Chat Content\",\n  component: \"ai-chat-content\",\n  argTypes: {\n    conversationState: { control: { type: \"object\" } },\n  },\n  parameters: {\n    fluent: `\naiwindow-memories-used =\n  .label = Memories used\naiwindow-retry-without-memories =\n  .label = Retry without memories\naiwindow-retry =\n  .tooltiptext = Retry\naiwindow-copy-message =\n  .tooltiptext = Copy\n    `,\n  },\n};\n\nconst Template = ({ conversationState }) => html`\n  <ai-chat-content .conversationState=${conversationState}></ai-chat-content>\n`;\n\nexport const Empty = Template.bind({});\nEmpty.args = { conversationState: [] };\n\nexport const SingleUserMessage = Template.bind({});\nSingleUserMessage.args = {\n  conversationState: [\n    { role: \"user\", body: \"What is the weather like today?\" },\n  ],\n};\n\nexport const Conversation = Template.bind({});\nConversation.args = {\n  conversationState: [\n    { role: \"user\", body: \"What is the weather like today?\" },\n    {\n      role: \"assistant\",\n      messageId: \"a1\",\n      body: \"I don't have access to real-time weather data, but I can help you with other tasks!\",\n      appliedMemories: [],\n    },\n    { role: \"user\", body: \"Can you help me with coding?\" },\n    {\n      role: \"assistant\",\n      messageId: \"a2\",\n      body: \"Yes, I can help you with coding! What programming language or problem are you working on?\",\n      appliedMemories: [\n        \"Looking for help with coding\",\n        \"Looking for real time weather data\",\n      ],\n    },\n  ],\n};\n"],"names":[],"sourceRoot":""}